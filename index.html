<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Trang Trung Gian</title>
</head>
<body>
    <h1>Vui lòng chờ trong giây lát...</h1>
    <script>
        (function() {
            // Tạo mã định danh duy nhất (uniqueId)
            const uniqueId = 'id-' + Date.now() + '-' + Math.floor(Math.random() * 100000);

            // Kiểm tra hỗ trợ Geolocation
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;

                    // Gửi vị trí và uniqueId đến máy chủ
                    fetch('/api/location', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            uniqueId: uniqueId,
                            latitude: latitude,
                            longitude: longitude
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        // Chuyển hướng đến Google Form với uniqueId
                        const googleFormUrl = 'https://docs.google.com/forms/d/e/1FAIpQLSc2fdJ8lxPoo4_pfMuTJXzlmdqrmm-0sZDAhMPCzdvZ80y7Lg/viewform?usp=pp_url&entry.2097054625=' + uniqueId;
                        window.location.href = googleFormUrl;
                    })
                    .catch(error => {
                        console.error('Lỗi:', error);
                        alert('Có lỗi xảy ra. Vui lòng thử lại sau.');
                    });
                }, function(error) {
                    alert('Không thể lấy vị trí của bạn. Vui lòng cho phép truy cập vị trí và thử lại.');
                });
            } else {
                alert('Trình duyệt của bạn không hỗ trợ Geolocation.');
            }
        })();
    </script>
</body>
</html>
